!function (e) { function t(t, n) { function a() { clearTimeout(P), P = !1, S = !1 } function i(t, n) { var a, i, r; return t.preventDefault(), a = e(t.target).offset(), clearTimeout(P), P = !1, "undefined" != typeof t.targetTouches ? (i = Math.floor(t.targetTouches[0].pageX - a.left), r = Math.floor(t.targetTouches[0].pageY - a.top)) : (i = Math.floor(t.pageX - a.left), r = Math.floor(t.pageY - a.top)), O.x === i && O.y === r ? !0 : (null === O.x && (O.x = i), null === O.y && (O.y = r), n && (r += n), k.beginPath(), k.moveTo(O.x, O.y), k.lineTo(i, r), k.lineCap = x.penCap, k.stroke(), k.closePath(), T.push({ lx: i, ly: r, mx: O.x, my: O.y }), O.x = i, O.y = r, void (x.onDraw && "function" == typeof x.onDraw && x.onDraw.apply(b))) } function r() { o() } function o(t) { t ? i(t, 1) : (W ? D.each(function () { this.removeEventListener("touchmove", i) }) : D.unbind("mousemove.signaturepad"), T.length > 0 && x.onDrawEnd && "function" == typeof x.onDrawEnd && x.onDrawEnd.apply(b)), O.x = null, O.y = null, x.output && T.length > 0 && e(x.output, I).val(JSON.stringify(T)) } function s() { return x.lineWidth ? (k.beginPath(), k.lineWidth = x.lineWidth, k.strokeStyle = x.lineColour, k.moveTo(x.lineMargin, x.lineTop), k.lineTo(E.width - x.lineMargin, x.lineTop), k.stroke(), void k.closePath()) : !1 } function u() { k.clearRect(0, 0, E.width, E.height), k.fillStyle = x.bgColour, k.fillRect(0, 0, E.width, E.height), x.displayOnly || s(), k.lineWidth = x.penWidth, k.strokeStyle = x.penColour, e(x.output, I).val(""), T = [], o() } function l(e, t) { null == O.x ? i(e, 1) : i(e, t) } function d(e, t) { W ? t.addEventListener("touchmove", l, !1) : D.bind("mousemove.signaturepad", l), i(e, 1) } function c() { F = !1, D.each(function () { this.removeEventListener && (this.removeEventListener("touchend", r), this.removeEventListener("touchcancel", r), this.removeEventListener("touchmove", i)), this.ontouchstart && (this.ontouchstart = null) }), e(document).unbind("mouseup.signaturepad"), D.unbind("mousedown.signaturepad"), D.unbind("mousemove.signaturepad"), D.unbind("mouseleave.signaturepad"), e(x.clear, I).unbind("click.signaturepad") } function p(t) { return F ? !1 : (F = !0, e("input").blur(), "undefined" != typeof t.targetTouches && (W = !0), void (W ? (D.each(function () { this.addEventListener("touchend", r, !1), this.addEventListener("touchcancel", r, !1) }), D.unbind("mousedown.signaturepad")) : (e(document).bind("mouseup.signaturepad", function () { S && (o(), a()) }), D.bind("mouseleave.signaturepad", function (e) { S && o(e), S && !P && (P = setTimeout(function () { o(), a() }, 500)) }), D.each(function () { this.ontouchstart = null })))) } function f() { e(x.typed, I).hide(), u(), D.each(function () { this.ontouchstart = function (e) { e.preventDefault(), S = !0, p(e), d(e, this) } }), D.bind("mousedown.signaturepad", function (e) { return e.preventDefault(), e.which > 1 ? !1 : (S = !0, p(e), void d(e)) }), e(x.clear, I).bind("click.signaturepad", function (e) { e.preventDefault(), u() }), e(x.typeIt, I).bind("click.signaturepad", function (e) { e.preventDefault(), h() }), e(x.drawIt, I).unbind("click.signaturepad"), e(x.drawIt, I).bind("click.signaturepad", function (e) { e.preventDefault() }), e(x.typeIt, I).removeClass(x.currentClass), e(x.drawIt, I).addClass(x.currentClass), e(x.sig, I).addClass(x.currentClass), e(x.typeItDesc, I).hide(), e(x.drawItDesc, I).show(), e(x.clear, I).show() } function h() { u(), c(), e(x.typed, I).show(), e(x.drawIt, I).bind("click.signaturepad", function (e) { e.preventDefault(), f() }), e(x.typeIt, I).unbind("click.signaturepad"), e(x.typeIt, I).bind("click.signaturepad", function (e) { e.preventDefault() }), e(x.output, I).val(""), e(x.drawIt, I).removeClass(x.currentClass), e(x.typeIt, I).addClass(x.currentClass), e(x.sig, I).removeClass(x.currentClass), e(x.drawItDesc, I).hide(), e(x.clear, I).hide(), e(x.typeItDesc, I).show(), L = M = e(x.typed, I).css("font-size").replace(/px/, "") } function g(t) { var n = e(x.typed, I), a = t.replace(/>/g, "&gt;").replace(/</g, "&lt;").trim(), i = B, r = .5 * L; if (B = a.length, n.html(a), !a) return void n.css("font-size", M + "px"); if (B > i && n.outerWidth() > E.width) for (; n.outerWidth() > E.width;)L--, n.css("font-size", L + "px"); if (i > B && n.outerWidth() + r < E.width && M > L) for (; n.outerWidth() + r < E.width && M > L;)L++, n.css("font-size", L + "px") } function v(t, n) { e("p." + n.errorClass, t).remove(), t.removeClass(n.errorClass), e("input, label", t).removeClass(n.errorClass) } function m(t, n, a) { t.nameInvalid && (n.prepend(['<p class="', a.errorClass, '">', a.errorMessage, "</p>"].join("")), e(a.name, n).focus(), e(a.name, n).addClass(a.errorClass), e("label[for=" + e(a.name).attr("id") + "]", n).addClass(a.errorClass)), t.drawInvalid && (e("#sigLabel").addClass("error"), e("#sigBox").addClass("error"), e("#sigBox").addClass("error"), e("#sigEn").addClass("error"), e("#sigSp").addClass("error")) } function y() { var t = !0, n = { drawInvalid: !1, nameInvalid: !1 }, a = [I, x], i = [n, I, x]; return x.onBeforeValidate && "function" == typeof x.onBeforeValidate ? x.onBeforeValidate.apply(b, a) : v.apply(b, a), x.drawOnly && T.length < 1 && (n.drawInvalid = !0, t = !1), "" === e(x.name, I).val() && (n.nameInvalid = !0, t = !1), x.onFormError && "function" == typeof x.onFormError ? x.onFormError.apply(b, i) : m.apply(b, i), t } function C(e, t, n) { for (var a in e) "object" == typeof e[a] && (t.beginPath(), t.moveTo(e[a].mx, e[a].my), t.lineTo(e[a].lx, e[a].ly), t.lineCap = x.penCap, t.stroke(), t.closePath(), n && T.push({ lx: e[a].lx, ly: e[a].ly, mx: e[a].mx, my: e[a].my })) } function w() { parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent) || [0, "4_2"])[1].replace("_", ".")) < 4.1 && (e.fn.Oldoffset = e.fn.offset, e.fn.offset = function () { var t = e(this).Oldoffset(); return t.top -= window.scrollY, t.left -= window.scrollX, t }), e(x.typed, I).bind("selectstart.signaturepad", function (t) { return e(t.target).is(":input") }), D.bind("selectstart.signaturepad", function (t) { return e(t.target).is(":input") }), !E.getContext && FlashCanvas && FlashCanvas.initElement(E), E.getContext && (k = E.getContext("2d"), e(x.sig, I).show(), x.displayOnly || (x.drawOnly || (e(x.name, I).bind("keyup.signaturepad", function () { g(e(this).val()) }), e(x.name, I).bind("blur.signaturepad", function () { g(e(this).val()) }), e(x.drawIt, I).bind("click.signaturepad", function (e) { e.preventDefault(), f() })), x.drawOnly || "drawIt" === x.defaultAction ? f() : h(), x.validateFields && (e(t).is("form") ? e(t).bind("submit.signaturepad", function () { return y() }) : e(t).parents("form").bind("submit.signaturepad", function () { return y() })), e(x.sigNav, I).show())) } var b = this, x = e.extend({}, e.fn.signaturePad.defaults, n), I = e(t), D = e(x.canvas, I), E = D.get(0), k = null, O = { x: null, y: null }, T = [], P = !1, S = !1, W = !1, F = !1, M = 30, L = M, B = 0; e.extend(b, { init: function () { w() }, updateOptions: function (t) { e.extend(x, t) }, regenerate: function (t) { b.clearCanvas(), e(x.typed, I).hide(), "string" == typeof t && (t = JSON.parse(t)), C(t, k, !0), x.output && e(x.output, I).length > 0 && e(x.output, I).val(JSON.stringify(T)) }, clearCanvas: function () { u() }, getSignature: function () { return T }, getSignatureString: function () { return JSON.stringify(T) }, getSignatureImage: function () { var e = document.createElement("canvas"), t = null, n = null; return e.style.position = "absolute", e.style.top = "-999em", e.width = E.width, e.height = E.height, document.body.appendChild(e), !e.getContext && FlashCanvas && FlashCanvas.initElement(e), t = e.getContext("2d"), t.fillStyle = x.bgColour, t.fillRect(0, 0, E.width, E.height), t.lineWidth = x.penWidth, t.strokeStyle = x.penColour, C(T, t), n = e.toDataURL.apply(e, arguments), document.body.removeChild(e), e = null, n }, validateForm: function () { return y() } }) } e.fn.signaturePad = function (n) { var a = null; return this.each(function () { e.data(this, "plugin-signaturePad") ? (a = e.data(this, "plugin-signaturePad"), a.updateOptions(n)) : (a = new t(this, n), a.init(), e.data(this, "plugin-signaturePad", a)) }), a }, e.fn.signaturePad.defaults = { defaultAction: "typeIt", displayOnly: !1, drawOnly: !1, canvas: "canvas", sig: ".sig", sigNav: ".sigNav", bgColour: "#efefef", penColour: "#145394", penWidth: 2, penCap: "round", lineColour: "#ccc", lineWidth: 2, lineMargin: 5, lineTop: 120, name: ".name", typed: ".typed", clear: ".clearButton", typeIt: ".typeIt a", drawIt: ".drawIt a", typeItDesc: ".typeItDesc", drawItDesc: ".drawItDesc", output: ".output", currentClass: "current", validateFields: 0, errorClass: "error", errorMessage: "Please enter your name", errorMessageDraw: "Please sign the document", onBeforeValidate: null, onFormError: null, onDraw: null, onDrawEnd: null } }(jQuery);